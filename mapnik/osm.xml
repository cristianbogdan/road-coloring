<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE Map [
<!ENTITY % entities SYSTEM "inc/entities.xml.inc">
%entities;
]>
<Map background-color="transparent" srs="&srs900913;" minimum-version="2.0.0">
  &fontset-settings;

  <Style name="roads">
    <Rule>
      &maxscale_zoom5;
      &minscale_zoom6;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke56]" stroke-dasharray="[dash56]"/>
    </Rule>
    
    <Rule>
      &maxscale_zoom7;
      &minscale_zoom7;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke7]" stroke-dasharray="[dash7]"/>
    </Rule>

    <Rule>
      &maxscale_zoom8;
      &minscale_zoom8;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke8]" stroke-dasharray="[dash8]"/>
    </Rule>

    <Rule>
      &maxscale_zoom9;
      &minscale_zoom9;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke9]" stroke-dasharray="[dash9]"/>
    </Rule>

    <Rule>
      &maxscale_zoom10;
      &minscale_zoom10;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke10]" stroke-dasharray="[dash10]"/>
    </Rule>
    
    <Rule>
      &maxscale_zoom11;
      &minscale_zoom12;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke11]" stroke-dasharray="[dash11]"/>
    </Rule>
    <Rule>
      &maxscale_zoom13;
      <LineSymbolizer stroke="[color]" stroke-width="[stroke13]" stroke-dasharray="[dash11]"/>
    </Rule>
</Style>

<Style name="roads-text-name">
    <Rule>
      <Filter>[highway] = 'motorway' or [highway] = 'trunk'  and [has_smoothness]</Filter>
      &maxscale_zoom7;
      &minscale_zoom7;
      <TextSymbolizer   repeat-distance="30" margin="30" size="9" spacing="0" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1.5">[name]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'motorway' or [highway] = 'trunk' or [highway] = 'primary'  and [has_smoothness] </Filter>
      &maxscale_zoom8;
      &minscale_zoom9;
      <TextSymbolizer    repeat-distance="30" margin="30" size="9" spacing="0" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1.5">[name]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'secondary'  and [has_smoothness]</Filter>
      &maxscale_zoom8;
      &minscale_zoom9;
      <TextSymbolizer    repeat-distance="50" margin="50" size="8" spacing="0" fill="black" placement="line" fontset-name="book-fonts" halo-radius="1" halo-fill="white">[name]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'motorway' or [highway] = 'trunk' or [highway] = 'primary'  and [has_smoothness] </Filter>
      &maxscale_zoom10;
      &minscale_zoom13;
      <TextSymbolizer    repeat-distance="30" margin="30" size="10" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1.5" >[name]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'secondary' and [has_smoothness] </Filter>
      &maxscale_zoom10;
      &minscale_zoom13;
      <TextSymbolizer    repeat-distance="50" margin="50" size="8" fill="black" placement="line" fontset-name="book-fonts" halo-radius="1" halo-fill="white">[name]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'motorway' or [highway] = 'trunk' or [highway] = 'primary'</Filter>
      &maxscale_zoom14;
      &minscale_zoom14;
      <TextSymbolizer    repeat-distance="30" margin="30" size="10" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'motorway' or [highway] = 'trunk' or [highway] = 'primary'</Filter>
      &maxscale_zoom15;
      &minscale_zoom18;
      <TextSymbolizer    repeat-distance="30" margin="30" size="10" fill="black" placement="line" fontset-name="book-fonts" halo-fill="white" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'secondary'</Filter>
      &maxscale_zoom14;
      &minscale_zoom14;
      <TextSymbolizer    repeat-distance="50" margin="50" size="9" fill="black" placement="line" fontset-name="book-fonts" halo-radius="1" halo-fill="white">[survey_year]</TextSymbolizer>
    </Rule><Rule>
      <Filter>[highway] = 'secondary'</Filter>
      &maxscale_zoom15;
      &minscale_zoom18;
      <TextSymbolizer    repeat-distance="50" margin="50" size="10" fill="black" placement="line" fontset-name="book-fonts" halo-radius="1" halo-fill="white">[survey_year]</TextSymbolizer>
    </Rule> 
    <Rule>
      <Filter>[highway] = 'tertiary'  and [has_smoothness]</Filter>
      &maxscale_zoom11;
      &minscale_zoom12;
      <TextSymbolizer    repeat-distance="50" margin="50" size="8" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1">[name]</TextSymbolizer>
    </Rule>
        <Rule>
      <Filter>[highway] = 'tertiary'</Filter>
      &maxscale_zoom13;
      &minscale_zoom13;
      <TextSymbolizer    repeat-distance="50" margin="50" size="8" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1">[name]</TextSymbolizer>
    </Rule>
   <Rule>
      <Filter>[highway] = 'tertiary' and [has_smoothness]</Filter>
      &maxscale_zoom14;
      &minscale_zoom16;
      <TextSymbolizer    repeat-distance="50" margin="50" size="9" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'tertiary'and [has_smoothness] </Filter>
      &maxscale_zoom17;
      &minscale_zoom18;
      <TextSymbolizer    repeat-distance="50" margin="50" size="11" fill="#000" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>

       <Rule>
      <Filter>[highway] = 'tertiary' </Filter>
      &maxscale_zoom14;
      &minscale_zoom16;
      <TextSymbolizer    repeat-distance="50" margin="50" size="9" fill="black" halo-fill="white" placement="line" fontset-name="book-fonts" halo-radius="1">[name]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'tertiary'</Filter>
      &maxscale_zoom17;
      &minscale_zoom18;
      <TextSymbolizer    repeat-distance="50" margin="50" size="11" fill="#000" placement="line" fontset-name="book-fonts" halo-radius="1">[name]</TextSymbolizer>
    </Rule>

    <!--
    <Rule>
      &maxscale_zoom13;
      &minscale_zoom15;
      <Filter>[highway] = 'proposed' or [highway]='construction'</Filter>
      <TextSymbolizer size="9" fill="#000" placement="line" fontset-name="book-fonts" halo-radius="1">[name]</TextSymbolizer>
    </Rule>
    <Rule>
      &maxscale_zoom16;
      &minscale_zoom18;
      <Filter>[highway] = 'proposed' or [highway]='construction'</Filter>
      <TextSymbolizer size="11" fill="#000" placement="line" fontset-name="book-fonts" halo-radius="1">[name]</TextSymbolizer>
      </Rule>
      -->
    <Rule>
      <Filter>[highway] = 'unclassified' or [highway] = 'residential'  and [has_smoothness]</Filter>
      &maxscale_zoom15;
      &minscale_zoom15;
      <TextSymbolizer    repeat-distance="50" margin="50" size="8" fill="#000" spacing="300" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'unclassified' or [highway] = 'residential'  and [has_smoothness] </Filter>
      &maxscale_zoom16;
      &minscale_zoom16;
      <TextSymbolizer    repeat-distance="50" margin="50" size="9" fill="#000" spacing="300" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <Rule>
      <Filter>[highway] = 'unclassified' or [highway] = 'residential'  and [has_smoothness] </Filter>
      &maxscale_zoom17;
      &minscale_zoom18;
      <TextSymbolizer    repeat-distance="50" margin="50" size="11" fill="#000" spacing="400" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <!--
    <Rule>
      <ElseFilter/>
      &maxscale_zoom15;
      &minscale_zoom16;
      <TextSymbolizer size="9" fill="#000" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
    </Rule>
    <Rule>
      <ElseFilter/>
      &maxscale_zoom17;
      &minscale_zoom18;
      <TextSymbolizer size="11" fill="#000" placement="line" fontset-name="book-fonts" halo-radius="1">[survey_year]</TextSymbolizer>
      </Rule>
-->
</Style>

<Layer name="roads" status="on" srs="&osm2pgsql_projection;">
    <StyleName>roads</StyleName>
    <Datasource>
      <Parameter name="table">
	(select way,
	
	case when smoothness='excellent' then '&excellent_color;'
	when smoothness='good' then '&good_color;'
	when smoothness='intermediate' then '&intermediate_color;'
	when smoothness='bad' or smoothness='very_bad' then '&bad_color;'
	when smoothness='horrible' or smoothness='very_horrible' or smoothness='impassable' then '&horrible_color;'
	end as color,
	
	case when highway='motorway' or highway='motorway_link' then &motorway56stroke;
	when highway='trunk' or highway='trunk_link' then &trunk56stroke;
	else 0 end as stroke56,

	case when highway='motorway' or highway='motorway_link' then &motorway78stroke;
	when highway='trunk' or highway='trunk_link' then &trunk78stroke;
	when highway='primary' or highway='primary_link' then &trunk78stroke;
	else 0 end as stroke7,

	case when highway='motorway' or highway='motorway_link' then &motorway78stroke;
	when highway='trunk' or highway='trunk_link' then &trunk78stroke;
	when highway='primary' or highway='primary_link' then &primary78stroke;
	when highway='secondary' or highway='secondary_link' then &secondary8stroke;
	else 0 end as stroke8,

	case when highway='motorway' or highway='motorway_link' then &motorway9stroke;
	when highway='trunk' or highway='trunk_link' then &trunk910stroke;
	when highway='primary' or highway='primary_link' then &primary9stroke;
	when highway='secondary' or highway='secondary_link' then &secondary910stroke;
	else 0 end as stroke9,

	case when highway='motorway' or highway='motorway_link' then &motorway10stroke;
	when highway='trunk' or highway='trunk_link' then &trunk910stroke;
	when highway='primary' or highway='primary_link' then &primary10stroke;
	when highway='secondary' or highway='secondary_link' then &secondary910stroke;
	else 0 end as stroke10,

	case when highway='motorway' or highway='motorway_link' then &motorway1113stroke;
	when highway='trunk' or highway='trunk_link' then &trunk1113stroke;
	when highway='primary' or highway='primary_link' then &primary1113stroke;
	when highway='secondary' or highway='secondary_link' then &secondary1113stroke;
	when highway='tertiary' or highway='tertiary_link' then &tertiary1113stroke;
	else 0 end as stroke11,

	case when highway='motorway' or highway='motorway_link' then &motorway1113stroke;
	when highway='trunk' or highway='trunk_link' then &trunk1113stroke;
	when highway='primary' or highway='primary_link' then &primary1113stroke;
	when highway='secondary' or highway='secondary_link' then &secondary1113stroke;
	else &tertiary1113stroke; end as stroke13,

	case when surface in ('asphalt', 'paved', 'sett', 'paving_stones', 'cobblestone', 'metal') or surface like 'concrete%' then '1,0' else '3,3' end as dash56,
	case when surface in ('asphalt', 'paved', 'sett', 'paving_stones', 'cobblestone', 'metal') or surface like 'concrete%' then '1,0' else '3,3' end as dash7,
	case when surface in ('asphalt', 'paved', 'sett', 'paving_stones', 'cobblestone', 'metal') or surface like 'concrete%' then '1,0' else '3,3' end as dash8,
	case when surface in ('asphalt', 'paved', 'sett', 'paving_stones', 'cobblestone', 'metal') or surface like 'concrete%' then '1,0' else '5,5' end as dash9,
	case when surface in ('asphalt', 'paved', 'sett', 'paving_stones', 'cobblestone', 'metal') or surface like 'concrete%' then '1,0' else '5,5' end as dash10,
	case when surface in ('asphalt', 'paved', 'sett', 'paving_stones', 'cobblestone', 'metal') or surface like 'concrete%' then '1,0' else '5,5' end as dash11
	
       from roads
       where highway is not null and not (highway='construction') and not (highway='proposed') and smoothness is not null and (access is null or access='yes')
       order by z_order
      ) as roads
      </Parameter>
      &datasource-settings;
    </Datasource>
</Layer>

<Layer name="roads-rehab" status="on" srs="&osm2pgsql_projection;">
    <StyleName>roads</StyleName>
    <Datasource>
      <Parameter name="table">
	(select way,
	
	case when highway='motorway' or highway='motorway_link' then &motorway56stroke;
	when highway='trunk' or highway='trunk_link' then &trunk56stroke;
	else 0 end as stroke56,

	case when highway='motorway' or highway='motorway_link' then &motorway78stroke;
	when highway='trunk' or highway='trunk_link' then &trunk78stroke;
	when highway='primary' or highway='primary_link' then &trunk78stroke;
	else 0 end as stroke7,

	case when highway='motorway' or highway='motorway_link' then &motorway78stroke;
	when highway='trunk' or highway='trunk_link' then &trunk78stroke;
	when highway='primary' or highway='primary_link' then &primary78stroke;
	when highway='secondary' or highway='secondary_link' then &secondary8stroke;
	else 0 end as stroke8,

	case when highway='motorway' or highway='motorway_link' then &motorway9stroke;
	when highway='trunk' or highway='trunk_link' then &trunk910stroke;
	when highway='primary' or highway='primary_link' then &primary9stroke;
	when highway='secondary' or highway='secondary_link' then &secondary910stroke;
	else 0 end as stroke9,

	case when highway='motorway' or highway='motorway_link' then &motorway10stroke;
	when highway='trunk' or highway='trunk_link' then &trunk910stroke;
	when highway='primary' or highway='primary_link' then &primary10stroke;
	when highway='secondary' or highway='secondary_link' then &secondary910stroke;
	else 0 end as stroke10,

	case when highway='motorway' or highway='motorway_link' then &motorway1113stroke;
	when highway='trunk' or highway='trunk_link' then &trunk1113stroke;
	when highway='primary' or highway='primary_link' then &primary1113stroke;
	when highway='secondary' or highway='secondary_link' then &secondary1113stroke;
	when highway='tertiary' or highway='tertiary_link' then &tertiary1113stroke;
	else 0 end as stroke11,

	case when highway='motorway' or highway='motorway_link' then &motorway1113stroke;
	when highway='trunk' or highway='trunk_link' then &trunk1113stroke;
	when highway='primary' or highway='primary_link' then &primary1113stroke;
	when highway='secondary' or highway='secondary_link' then &secondary1113stroke;
	else &tertiary1113stroke; end as stroke13,
	'3,8' as dash56,
	'3,8' as dash7,
	'3,8' as dash8,
	'5,10' as dash9,
	'5,10' as dash10,
	'5,10' as dash11,

	'&excellent_color;' as color
	
       from roads
       where highway is not null and not (highway='construction') and not (highway='proposed') and surface_survey like '%REHAB%' and (access is null or access='yes')
      ) as roads
      </Parameter>
      &datasource-settings;
    </Datasource>
</Layer>
<!--
<Layer name="roads-text-ref-low-zoom" status="on" srs="&osm2pgsql_projection;">
     <StyleName>roads-text-ref-low-zoom</StyleName>
     <Datasource>
      <Parameter name="table">
      (select way,highway,ref,char_length(ref) as length
       from &prefix;_roads
       where highway in ('motorway','trunk','primary','secondary')
         and ref is not null
         and char_length(ref) between 1 and 8
      ) as roads
      </Parameter>
      &datasource-settings;
    </Datasource>
</Layer>

<Layer name="roads-text-ref" status="on" srs="&osm2pgsql_projection;">
     <StyleName>roads-text-ref</StyleName>
     <Datasource>
      <Parameter name="table">
      (select way,highway,aeroway,ref,char_length(ref) as length,
       case when bridge in ('yes','true','1','viaduct','swing','lift') then 'yes'::text else bridge end as bridge
       from &prefix;_line
       where (highway is not null or aeroway is not null)
         and ref is not null
         and char_length(ref) between 1 and 8
      ) as roads
      </Parameter>
      &datasource-settings;
    </Datasource>
    </Layer>

-->
<Layer name="roads-text-name" status="on" srs="&osm2pgsql_projection;">
     <StyleName>roads-text-name</StyleName>
     <Datasource>
      <Parameter name="table">
	(select way,highway, 
	case when ref is not null then ref else name end as name,
	case when surface_survey is not null then (regexp_matches(surface_survey, '\d\d\d\d'))[1] else '' end as survey_year,
	smoothness is not null as has_smoothness
	
       from roads
       where (surface_survey is not null or name is not null or ref is not null) and (access is null or access='yes')
      ) as roads
      </Parameter>
<!--
      <Parameter name="table">
      (select way,highway, case when surface_survey is not null then (regexp_matches(surface_survey, '\d\d\d\d'))[1] else name end as name
       from &prefix;_line
       where osm_id>0 and 
         waterway IS NULL
         and leisure IS NULL
         and landuse IS NULL
         and (surface_survey is not null or name is not null)
      ) as roads
      </Parameter>
-->
      &datasource-settings;
    </Datasource>
</Layer>

</Map>
